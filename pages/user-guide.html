<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Artem Bityutskiy" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="User Guide"/>
    <meta property="og:url" content="../pages/user-guide.html"/>
    <meta property="og:site_name" content="Wult"/>
    <meta property="og:type" content="website"/>

    <link rel="canonical" href="../pages/user-guide.html" />

    <title>User Guide | Wult</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="../theme/css/main.css" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="../">Wult </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="/wult/index.html">Overview</a></li>
                            <li ><a href="/wult/pages/install-guide.html">Install</a></li>
                            <li ><a href="/wult/pages/user-guide.html">Use</a></li>
                            <li ><a href="/wult/pages/ndl.html">Ndl</a></li>
                        </ul>

                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
        
<section  >    
    <h1 class="entry-title">User Guide</h1>
    
    <!-- -*- coding: utf-8 -*- -->
<!-- vim: ts=4 sw=4 tw=100 et ai si -->
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#local-vs-remote-usage" id="id1">1. Local vs Remote usage</a></li>
<li><a class="reference internal" href="#scan-for-supported-devices" id="id2">2. Scan for supported devices</a></li>
<li><a class="reference internal" href="#start-the-measurements" id="id3">3. Start the measurements</a></li>
<li><a class="reference internal" href="#generate-html-report" id="id4">4. Generate HTML report</a><ul>
<li><a class="reference internal" href="#advanced-example" id="id5">4.1. Advanced example</a></li>
</ul>
</li>
</ul>
</div>
<p>This user guide provides basic <em>wult</em> command-line usage instructions. However, there are advanced
commands and options which are not described in this guide. Please, use the '--help' option for more
information. Wult also comes with the man page, but generally, the '--help' contents tends to be
more verbose.</p>
<p>Feel free to ask questions by filing GitHub issues (preferred) or sending an e-mail to
Artem Bityutskiy &lt;<a class="reference external" href="mailto:dedekind1&#64;gmail.com">dedekind1&#64;gmail.com</a>&gt;.</p>
<div class="section" id="local-vs-remote-usage">
<h2><a class="toc-backref" href="#id1">1. Local vs Remote usage</a></h2>
<p>In case of the <a class="reference external" href="../index.html#local-usage-model">local usage model</a>, <em>wult</em> has to be run on the
SUT as 'root'. In case of <a class="reference external" href="../index.html#remote-usage-model">remote usage model</a>, <em>wult</em> should be
run on the controller under unprivileged user, but the user should have passwordless root SSH login
from the controller to the SUT (more info in <a class="reference external" href="install-guide.html#passwordless-ssh">this</a> section).</p>
<p>The command line arguments for the both cases is the same, except for the '-H SUTNAME' option in the
remote usage scenario, which specifies the SUT host name to connect to.</p>
</div>
<div class="section" id="scan-for-supported-devices">
<h2><a class="toc-backref" href="#id2">2. Scan for supported devices</a></h2>
<p>Start with scanning for supported delayed interrupt source devices. Run the following command on the
SUT in case of the local usage model:</p>
<pre class="literal-block">
sudo wult scan
</pre>
<p>or the following command in case of the remote usage model:</p>
<pre class="literal-block">
wult scan -H SUTNAME
</pre>
<p>We'll assume the reader distinguishes between the local and remote usage models, so we'll just
recommend to run the following command for simplicity:</p>
<pre class="literal-block">
wult scan
</pre>
<p>Here is an example output of 'wult scan':</p>
<pre class="literal-block">
Compatible device(s):
 * Device ID: tdt
   - Alias: timer
   - Description: TSC deadline timer on CPU0
 * Device ID: 0000:01:00.0
   - Alias: enp1s0
   - Description: Intel I210 (copper). PCI address 0000:01:00.0, Vendor ID 8086, Device ID 0000:01:00.0.
 * Device ID: 0000:31:00.0
   - Alias: enp2s0
   - Description: Intel I210 (copper). PCI address 0000:31:00.0, Vendor ID 8086, Device ID 0000:31:00.0.
</pre>
<p>The output lists 3 devices that can be used as delayed interrupt sources for <em>wult</em>:</p>
<ul class="simple">
<li><em>tdt</em> - the TCS deadline timer. It was detected on CPU0, but usually if it is present on one CPU,
then all CPUs have it. You can use both &quot;tdt&quot; and &quot;timer&quot; (alias) to specify this device.</li>
<li><em>0000:01:00.0</em> - this is the PCI address of the I210 NIC. This NIC is also available under the
&quot;enp1s0&quot; name, which is actually the Linux network interface name.</li>
<li><em>0000:31:00.0</em> - another I210 NIC (the &quot;enp2s0&quot; network interface.</li>
</ul>
<p>The &quot;tdt&quot; devices should always be OK to use for running <em>wult</em>. In case of the NIC, only an unused
NIC can be used for running <em>wult</em>. What does &quot;unused&quot; mean? Well, it means you do not use this
interface for networking and it is in the &quot;down&quot; state (you can bring it down using 'NetworkManager'
or the 'ip' command).</p>
</div>
<div class="section" id="start-the-measurements">
<h2><a class="toc-backref" href="#id3">3. Start the measurements</a></h2>
<p>Before you start <em>wult</em>, you should know which delayed interrupt device you are going to use (see
'wult scan'). Please, make sure to go through <a class="reference external" href="../index.html#irq-source">this section</a> so that you
understand various important settings like PCIe ASPM for the &quot;nic&quot; method.</p>
<p>The basic way to start <em>wult</em> is by running 'wult start DeviceID', and 'DeviceID's are provided by
'wult scan'. For example, to run <em>wult</em> with the TSC deadline timer, use:</p>
<pre class="literal-block">
wult start tdt
</pre>
<p>This command will collect 1000000 datapoints and save them in current directory in a sub-directory
like &quot;wult-tdt-&lt;date&gt;&quot;. Here are the main options you should probably use as well.</p>
<ul class="simple">
<li>'-c' - count of datapoints to collect.</li>
<li>'--reportid' - report ID of the result. Use a short, but descriptive string to describe the test
run.</li>
<li>'-o' - the output directory path.</li>
<li>'--cpunum' - the CPU to measure the C-state latency on.</li>
</ul>
<p>There are more options, use 'wult start -h' for help. Here is an example:</p>
<pre class="literal-block">
$ wult start -c 10000 --reportid all-cstates-enabled tdt
Compatible device 'TSC deadline timer':
 * Device ID: tdt
   - TSC deadline timer on CPU0
Binding device 'tdt' to driver 'wult_timer'
Start measuring CPU 0, collecting 10000 datapoints
Datapoints: 10000, max. latency: 407051 ns, rate: 472.15 datapoints/sec
Finished measuring CPU 0

$ ls all-cstates-enabled/
datapoints.csv  info.yml
</pre>
<p><em>Wult</em> collected 10000 datapoints and stored the result in 'all-cstates-enabled' (same as ReportID,
because '-o' was not used). The next step is to generate an HTML report out of the raw result in
'all-cstates-enabled' (or we could use the '--report' option with 'wult start', then it would also
generate the HTML report).</p>
</div>
<div class="section" id="generate-html-report">
<h2><a class="toc-backref" href="#id4">4. Generate HTML report</a></h2>
<p>The 'wult start' command collects the measurement and saves them in the 'datapoints.csv' file, along
with some additional metadata in the 'info.yml' file. Now what you can do with these raw results?
Well, you can quickly inspect the results using 'wult stats', or generate an HTML report using
'wult report'. Here is how to generate an HTML report for the raw results in
'all-cstates-enabled':</p>
<pre class="literal-block">
wult report all-cstates-enabled
</pre>
<p>The result will be in the 'wult-report-all-cstates-enabled' directory. Use '-o' option to specify
where you want the resulting HTML report to be stored.</p>
<p>Note, you can generate a diff - a single HTML report for multiple raw results. Diffs make it easier
to compare test results. Just give 'wult report' multiple test results to generate a diff.</p>
<div class="section" id="advanced-example">
<h3><a class="toc-backref" href="#id5">4.1. Advanced example</a></h3>
<p>This section describes how <a class="reference external" href="../results/ivt-c6-hfm-nic-vs-tdt/index.html">this diff</a> was generated.
The diff compares <em>nic</em> and <em>tdt</em> results for the same system (details
<a class="reference external" href="../index.html#c-state-prewake">here</a>).</p>
<p>We had two raw test results:</p>
<pre class="literal-block">
$ ls
ivt-nic-c6-hfm-noaspm  ivt-tdt-c6-hfm-noaspm
</pre>
<p>First is for the <em>nic</em> method, second is for the <em>tdt</em> method. We started with a default
'wult report' options:</p>
<pre class="literal-block">
$ wult report -o ivt-c6-hfm-nic-vs-tdt ivt-nic-c6-hfm-noaspm ivt-tdt-c6-hfm-noaspm

$ du -sh ivt-c6-hfm-nic-vs-tdt/
406M   ivt-c6-hfm-nic-vs-tdt/
</pre>
<p>This resulted in a 406M HTML report, which is too large to publish in GitHub web pages.</p>
<p>Each raw result contained 1000000 datapoints, which is quite a lot. So we decided to use only 10000
datapoints out of 1M.</p>
<pre class="literal-block">
$ rm -r ivt-c6-hfm-nic-vs-tdt
$ wult report -o ivt-c6-hfm-nic-vs-tdt --rsel 'index &lt; 10000' ivt-nic-c6-hfm-noaspm ivt-tdt-c6-hfm-noaspm

$ du -sh ivt-c6-hfm-nic-vs-tdt
82M    ivt-c6-hfm-nic-vs-tdt

$ ls ivt-c6-hfm-nic-vs-tdt/
CC0_pcnt.html  CC1_pcnt.html  CC3_pcnt.html  CC6_pcnt.html  index.html  LDist.html
PC2_pcnt.html  PC3_pcnt.html  PC6_pcnt.html  plots  raw-ivt-nic-c6-hfm-aspm
raw-ivt-tdt-c6-hfm-noaspm  SilentTime.html  style.css
</pre>
<p>The new diff was 82M, still a little too big. Besides, it contained too many scatter-plots, which
could overwhelm a non-expert. So we decided to strip the C-state scatter-plots and leave only
the wake latency scatter-plot and histogram.</p>
<pre class="literal-block">
$ wult report -o ivt-c6-hfm-nic-vs-tdt --rsel 'index &lt; 10000' --yaxes WakeLatency \
              --hist WakeLatency --chist none ivt-nic-c6-hfm-noaspm ivt-tdt-c6-hfm-noaspm

$ du -sh ivt-c6-hfm-nic-vs-tdt
11M    ivt-c6-hfm-nic-vs-tdt
</pre>
<p>This 11M diff looked fine and we added it to the web site, as an example.</p>
</div>
</div>

</section>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>